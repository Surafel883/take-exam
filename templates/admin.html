<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Admin Panel</title>
  <style>
    body {
      font-family: "Poppins", sans-serif;
      background: #f4f4f9;
      margin: 0;
      padding: 20px;
    }
    h2 {
      text-align: center;
      margin-bottom: 20px;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-bottom: 20px;
      background: white;
      border-radius: 10px;
      overflow: hidden;
    }
    th, td {
      padding: 12px 15px;
      border-bottom: 1px solid #ddd;
      text-align: center;
    }
    th {
      background: #4a90e2;
      color: white;
    }
    tr:hover {
      background: #f1f1f1;
    }
    button {
      padding: 5px 10px;
      margin: 2px;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      color: white;
    }
    .edit-btn { background: #f39c12; }
    .delete-btn { background: #e74c3c; }
    .verify-btn { background: #2ecc71; }
    input.edit-input {
      width: 90%;
      padding: 4px;
      border-radius: 4px;
      border: 1px solid #ccc;
    }
  </style>
</head>
<body>

<!-- Password Overlay -->
<div id="pwOverlay" style="position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.85);display:flex;justify-content:center;align-items:center;z-index:9999;">
  <div style="background:#fff;padding:30px 40px;border-radius:12px;text-align:center;box-shadow:0 4px 15px rgba(0,0,0,0.3);">
    <h2 style="margin-bottom:20px;font-family:'Poppins',sans-serif;color:#333;">Enter Password</h2>
    <input type="password" id="pwInput" placeholder="Password" size="100" style="padding:10px;font-size:16px;border-radius:6px;border:1px solid #ccc;margin-bottom:15px;">
    <br>
    <button id="pwSubmit" style="padding:10px 20px;font-size:16px;border:none;border-radius:6px;background:#2ecc71;color:#fff;cursor:pointer;">Submit</button>
    <p id="pwError" style="color:red;margin-top:10px;font-size:14px;"></p>
  </div>
</div>

<!-- Main Admin Panel -->
<div id="mainContent" style="display:none;">
  <h2>Admin Panel - Manage Accounts</h2>
  <table id="accounts-table">
    <thead>
      <tr>
        <th>ID</th>
        <th>Name</th>
        <th>Email</th>
        <th>Grade</th>
        <th>Section</th>
        <th>Phone</th>
        <th>Login Type</th>
        <th>Picture</th>
        <th>Verified</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody>
      <!-- Data will be injected here -->
    </tbody>
  </table>
</div>

<script>
  // Password script
  document.getElementById('pwSubmit').addEventListener('click', function() {
    let val = document.getElementById('pwInput').value;
    if(val === 'surafel1212') {
      document.getElementById('pwOverlay').style.display = 'none';
      document.getElementById('mainContent').style.display = 'block';
    } else {
      document.getElementById('pwError').textContent = 'Incorrect password! Try again.';
      document.getElementById('pwInput').value = '';
      document.getElementById('pwInput').focus();
    }
  });
  document.getElementById('pwInput').addEventListener('keypress', function(e){
    if(e.key === 'Enter') document.getElementById('pwSubmit').click();
  });

  // Existing admin scripts
  async function fetchAccounts() {
    const res = await fetch('/api/accounts');
    const accounts = await res.json();
    const tbody = document.querySelector('#accounts-table tbody');
    tbody.innerHTML = '';

    accounts.forEach(acc => {
      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td>${acc.id}</td>
        <td><input class="edit-input" value="${acc.name}" data-id="${acc.id}" data-field="name"></td>
        <td><input class="edit-input" value="${acc.email}" data-id="${acc.id}" data-field="email"></td>
        <td><input class="edit-input" value="${acc.grade || ''}" data-id="${acc.id}" data-field="grade"></td>
        <td><input class="edit-input" value="${acc.section || ''}" data-id="${acc.id}" data-field="section"></td>
        <td><input class="edit-input" value="${acc.phone || ''}" data-id="${acc.id}" data-field="phone"></td>
        <td>${acc.login_type}</td>
        <td>${acc.picture ? `<img src="${acc.picture}" width="50">` : ''}</td>
        <td>${acc.verified ? '✅' : '❌'}</td>
        <td>
          <button class="edit-btn" onclick="saveAccount(${acc.id})">Save</button>
          <button class="delete-btn" onclick="deleteAccount(${acc.id})">Delete</button>
          ${!acc.verified ? `<button class="verify-btn" onclick="verifyAccount(${acc.id})">Verify</button>` : ''}
        </td>
      `;
      tbody.appendChild(tr);
    });
  }

  async function saveAccount(id) {
    const inputs = document.querySelectorAll(`input[data-id='${id}']`);
    let updated = {};
    inputs.forEach(input => {
      updated[input.dataset.field] = input.value;
    });

    await fetch(`/api/accounts/${id}`, {
      method: 'PUT',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(updated)
    });
    alert('Account updated!');
    fetchAccounts();
  }

  async function deleteAccount(id) {
    if (!confirm('Are you sure you want to delete this account?')) return;
    await fetch(`/api/accounts/${id}`, { method: 'DELETE' });
    alert('Account deleted!');
    fetchAccounts();
  }

  async function verifyAccount(id) {
    await fetch(`/api/accounts/${id}/verify`, { method: 'PUT' });
    alert('Account verified!');
    fetchAccounts();
  }

  fetchAccounts();
</script>
</body>
</html>
